{"version":3,"sources":["../../lib/session.ts"],"names":["omit","getLink","toQueryString","http","sessionExists","sdk","session","get","then","res","status","catch","getSession","withCredentials","refresh","post","href","user","closeSession","httpRequest","url","getIssuerOrigin","method","refreshSession","setCookieAndRedirect","sessionToken","redirectUrl","window","location","assign","checkAccountSetupComplete","token"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA,SAASA,IAAT,EAAeC,OAAf,EAAwBC,aAAxB,QAA6C,QAA7C;AACA,OAAOC,IAAP,MAAiB,QAAjB;;AAEA,SAASC,aAAT,CAAuBC,GAAvB,EAA4B;AAC1B,SAAOA,GAAG,CAACC,OAAJ,CAAYC,GAAZ,GACJC,IADI,CACC,UAASC,GAAT,EAAc;AAClB,QAAIA,GAAG,CAACC,MAAJ,KAAe,QAAnB,EAA6B;AAC3B,aAAO,IAAP;AACD;;AACD,WAAO,KAAP;AACD,GANI,EAOJC,KAPI,CAOE,YAAW;AAChB,WAAO,KAAP;AACD,GATI,CAAP;AAUD;;AAED,SAASC,UAAT,CAAoBP,GAApB,EAAyB;AACvB,SAAOF,IAAI,CAACI,GAAL,CAASF,GAAT,EAAc,qBAAd,EAAqC;AAAEQ,IAAAA,eAAe,EAAE;AAAnB,GAArC,EACNL,IADM,CACD,UAASF,OAAT,EAAkB;AACtB,QAAIG,GAAG,GAAGT,IAAI,CAACM,OAAD,EAAU,QAAV,CAAd;;AAEAG,IAAAA,GAAG,CAACK,OAAJ,GAAc,YAAW;AACvB,aAAOX,IAAI,CAACY,IAAL,CAAUV,GAAV,EAAeJ,OAAO,CAACK,OAAD,EAAU,SAAV,CAAP,CAA4BU,IAA3C,EAAiD,EAAjD,EAAqD;AAAEH,QAAAA,eAAe,EAAE;AAAnB,OAArD,CAAP;AACD,KAFD;;AAIAJ,IAAAA,GAAG,CAACQ,IAAJ,GAAW,YAAW;AACpB,aAAOd,IAAI,CAACI,GAAL,CAASF,GAAT,EAAcJ,OAAO,CAACK,OAAD,EAAU,MAAV,CAAP,CAAyBU,IAAvC,EAA6C;AAAEH,QAAAA,eAAe,EAAE;AAAnB,OAA7C,CAAP;AACD,KAFD;;AAIA,WAAOJ,GAAP;AACD,GAbM,EAcNE,KAdM,CAcA,YAAW;AAChB;AACA,WAAO;AAACD,MAAAA,MAAM,EAAE;AAAT,KAAP;AACD,GAjBM,CAAP;AAkBD;;AAED,SAASQ,YAAT,CAAsBb,GAAtB,EAA2B;AACzB,SAAOF,IAAI,CAACgB,WAAL,CAAiBd,GAAjB,EAAsB;AAC3Be,IAAAA,GAAG,EAAEf,GAAG,CAACgB,eAAJ,KAAwB,qBADF;AAE3BC,IAAAA,MAAM,EAAE,QAFmB;AAG3BT,IAAAA,eAAe,EAAE;AAHU,GAAtB,CAAP;AAKD;;AAED,SAASU,cAAT,CAAwBlB,GAAxB,EAA6B;AAC3B,SAAOF,IAAI,CAACY,IAAL,CAAUV,GAAV,EAAe,uCAAf,EAAwD,EAAxD,EAA4D;AAAEQ,IAAAA,eAAe,EAAE;AAAnB,GAA5D,CAAP;AACD;;AAED,SAASW,oBAAT,CAA8BnB,GAA9B,EAAmCoB,YAAnC,EAAiDC,WAAjD,EAA8D;AAC5DA,EAAAA,WAAW,GAAGA,WAAW,IAAIC,MAAM,CAACC,QAAP,CAAgBZ,IAA7C;AACAW,EAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuBxB,GAAG,CAACgB,eAAJ,KAAwB,8BAAxB,GACrBnB,aAAa,CAAC;AACZ4B,IAAAA,yBAAyB,EAAE,IADf;AAEZC,IAAAA,KAAK,EAAEN,YAFK;AAGZC,IAAAA,WAAW,EAAEA;AAHD,GAAD,CADf;AAMD;;AAED,SACEtB,aADF,EAEEQ,UAFF,EAGEM,YAHF,EAIEK,cAJF,EAKEC,oBALF","sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n/* global window */\nimport { omit, getLink, toQueryString } from './util';\nimport http from './http';\n\nfunction sessionExists(sdk) {\n  return sdk.session.get()\n    .then(function(res) {\n      if (res.status === 'ACTIVE') {\n        return true;\n      }\n      return false;\n    })\n    .catch(function() {\n      return false;\n    });\n}\n\nfunction getSession(sdk) { \n  return http.get(sdk, '/api/v1/sessions/me', { withCredentials: true })\n  .then(function(session) {\n    var res = omit(session, '_links');\n\n    res.refresh = function() {\n      return http.post(sdk, getLink(session, 'refresh').href, {}, { withCredentials: true });\n    };\n\n    res.user = function() {\n      return http.get(sdk, getLink(session, 'user').href, { withCredentials: true });\n    };\n\n    return res;\n  })\n  .catch(function() {\n    // Return INACTIVE status on failure\n    return {status: 'INACTIVE'};\n  });\n}\n\nfunction closeSession(sdk) {\n  return http.httpRequest(sdk, {\n    url: sdk.getIssuerOrigin() + '/api/v1/sessions/me',\n    method: 'DELETE',\n    withCredentials: true\n  });\n}\n\nfunction refreshSession(sdk) {\n  return http.post(sdk, '/api/v1/sessions/me/lifecycle/refresh', {}, { withCredentials: true });\n}\n\nfunction setCookieAndRedirect(sdk, sessionToken, redirectUrl) {\n  redirectUrl = redirectUrl || window.location.href;\n  window.location.assign(sdk.getIssuerOrigin() + '/login/sessionCookieRedirect' +\n    toQueryString({\n      checkAccountSetupComplete: true,\n      token: sessionToken,\n      redirectUrl: redirectUrl\n    }));\n}\n\nexport {\n  sessionExists,\n  getSession,\n  closeSession,\n  refreshSession,\n  setCookieAndRedirect\n};\n"],"file":"session.js"}