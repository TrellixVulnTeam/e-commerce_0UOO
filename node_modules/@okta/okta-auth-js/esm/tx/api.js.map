{"version":3,"sources":["../../../lib/tx/api.ts"],"names":["http","AuthSdkError","STATE_TOKEN_KEY_NAME","addStateToken","AuthTransaction","transactionStatus","sdk","args","post","getIssuerOrigin","withCredentials","resumeTransaction","stateToken","tx","exists","_get","Promise","reject","status","then","res","introspect","transactionStep","transactionExists","postToTransaction","url","options"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\n/* eslint-disable complexity, max-statements */\nimport http from '../http';\nimport AuthSdkError from '../errors/AuthSdkError';\nimport { STATE_TOKEN_KEY_NAME } from '../constants';\nimport { addStateToken } from './util';\nimport { AuthTransaction } from './AuthTransaction';\n\nfunction transactionStatus(sdk, args) {\n  args = addStateToken(sdk, args);\n  return http.post(sdk, sdk.getIssuerOrigin() + '/api/v1/authn', args, { withCredentials: true });\n}\n\nfunction resumeTransaction(sdk, args) {\n  if (!args || !args.stateToken) {\n    var stateToken = sdk.tx.exists._get(STATE_TOKEN_KEY_NAME);\n    if (stateToken) {\n      args = {\n        stateToken: stateToken\n      };\n    } else {\n      return Promise.reject(new AuthSdkError('No transaction to resume'));\n    }\n  }\n  return sdk.tx.status(args)\n    .then(function(res) {\n      return new AuthTransaction(sdk, res);\n    });\n}\n\nfunction introspect (sdk, args) {\n  if (!args || !args.stateToken) {\n    var stateToken = sdk.tx.exists._get(STATE_TOKEN_KEY_NAME);\n    if (stateToken) {\n      args = {\n        stateToken: stateToken\n      };\n    } else {\n      return Promise.reject(new AuthSdkError('No transaction to evaluate'));\n    }\n  }\n  return transactionStep(sdk, args)\n    .then(function (res) {\n      return new AuthTransaction(sdk, res);\n    });\n}\n\nfunction transactionStep(sdk, args) {\n  args = addStateToken(sdk, args);\n  // v1 pipeline introspect API\n  return http.post(sdk, sdk.getIssuerOrigin() + '/api/v1/authn/introspect', args, { withCredentials: true });\n}\n\nfunction transactionExists(sdk) {\n  // We have a cookie state token\n  return !!sdk.tx.exists._get(STATE_TOKEN_KEY_NAME);\n}\n\nfunction postToTransaction(sdk, url, args, options?) {\n  return http.post(sdk, url, args, options)\n    .then(function(res) {\n      return new AuthTransaction(sdk, res);\n    });\n}\n\nexport {\n  transactionStatus,\n  resumeTransaction,\n  transactionExists,\n  postToTransaction,\n  introspect,\n};\n"],"file":"api.js"}